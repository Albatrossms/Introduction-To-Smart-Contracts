<html>
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<div>
    Count??
    <span id="count"> </span>
    <div>
        <button id="getCount">Get Count</button>
    </div>
    <div>
        <button id="increment">Increment</button>
    </div>
    <div>
        <button id="decrement">Decrement</button>
    </div>
    <div id="log"></div>
</div>
<script>
    var web3;
    var counter;
    const url = "http://localhost:8545";
    const contractAddress = "0xFf201fEA95aF25ED95033bf59b6DdC98d5d148Da";
    const abi = [
        {
            "constant": false,
            "inputs": [],
            "name": "decrement",
            "outputs": [],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "constant": false,
            "inputs": [],
            "name": "increment",
            "outputs": [],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "constant": true,
            "inputs": [],
            "name": "getCount",
            "outputs": [
                {
                    "internalType": "uint256",
                    "name": "",
                    "type": "uint256"
                }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        }
    ];
    function log(message) {
        $("#log")
            .append("<p>")
            .text(message);
        $("#log").scrollTop($("#log").prop('scrollHeight'));
    }

    function waitForTransactionReceipt(hash, cb) {
        web3.eth.getTransactionReceipt(hash, (err, receipt) => {
            if (receipt != null) {
                cb(receipt);
            } else {

                window.setTimeout(() => {
                    waitForTransactionReceipt(hash, cb);
                }, 1000);
            }
        })
    }

    $(function () {
        $("#getCount").click(e => {
            e.preventDefault();
            var account = web3.eth.accounts;

            log("Calling getCount on counter contact...");
            counter.methods.getCount().call({ from: account[0] }, (err, res) => {
                $("#count").text(res.toString());
            });
        });

        $("#increment").click(e => {
            e.preventDefault();

            log("Calling increment on counter contract...");

            web3.eth.getAccounts((err, accounts) => {
                counter.methods.increment().send(
                    { from: accounts[0], to: contractAddress }, (err, hash) => {
                        console.log(err);
                        console.log(hash);
                        waitForTransactionReceipt(hash, (receipt) => {
                            log("Calling increment on counter contract is successful. You may call get Count.");
                        })
                    }
                );
            })
        });

        $("#decrement").click(e => {
            e.preventDefault();

            log("Calling decrement on counter contract...");

            web3.eth.getAccounts((err, accounts) => {
                counter.methods.decrement().send(
                    { from: accounts[0], to: contractAddress }, (err, hash) => {

                        waitForTransactionReceipt(hash, (receipt) => {
                            log("Calling decrement on counter contract is successful. You may call get Count.");
                        })
                    }
                );
            });
        });

        web3 = new Web3(url);
        counter = new web3.eth.Contract(abi, contractAddress);
        $("#getCount").click();
    });
</script>

</html>